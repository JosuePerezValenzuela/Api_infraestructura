## Registrar una facultad

# Especificaciones:

Vision y alcance:

1. Crear facultades para inventario.
2. Crear facultades en menos de 2 minutos, errores de validacion comprensibles.
3. Security by default y security by desing.

Glosario y modelo conceptual:

1. Una facultad le pertenece a un campus
2. codigo es un Identificador unico

Reglas de negocio:

1. codigo es unico
2. nombre y direccion son obligatorios
3. lat y lng se envian juntos para convertir a POINT y dentro de rangos validos
4. nombre_corto es opcional.
5. campus_id indica a que campus pertenece.

Esquema:
CREATE TABLE infraestructura.facultades (
id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT BY 1 START WITH 1 ) ,
codigo varchar(16) NOT NULL UNIQUE,
nombre varchar(128) NOT NULL ,
nombre_corto varchar(16) ,
coordenadas point NOT NULL ,
activo boolean DEFAULT TRUE NOT NULL ,
creado_en timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL ,
actualizado_en timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL ,
campus_id integer NOT NULL ,
CONSTRAINT pk_facultades PRIMARY KEY ( id ),
CONSTRAINT fk_facultades_campus FOREIGN KEY ( campus_id ) REFERENCES infraestructura.campus( id )  
 );
{
"codigo": "12345",
"nombre": "Facultad de cieencias y tecnologia",
"nombre_corto": "FCyT",
"lat": -17.3939,
"lng": -66.15,
"campus_id": 1
}

Contratos de API
POST /api/facultades -> 201 { id }
400 VALIDATION_ERROR con details []
409 Ya existe una facultad con el mismo codigo

## HU - 5 Registrar una facultad

Como administrador de infraestructura
Quiero registrar una nueva facultad asociada a un campus
Para mantener un inventario centralizado y geolocalizado de la infraestructura

Alcance y reglas (resumen)

Cada facultad pertenece a un campus (campus_id requerido).

codigo es único.

nombre y coordenadas (lat,lng) son obligatorios (lat/lng deben venir juntos y dentro de rangos válidos).

nombre_corto es opcional.

Seguridad por defecto y por diseño (validación de entrada, manejo de errores claro).

Contrato de API

POST /api/facultades → 201 { id }

400 VALIDATION_ERROR con details[]

409 “Ya existe una facultad con el mismo codigo”

Ejemplo de request body

{
"codigo": "12345",
"nombre": "Facultad de ciencias y tecnologia",
"nombre_corto": "FCyT",
"lat": -17.3939,
"lng": -66.15,
"campus_id": 1
}

Criterios de Aceptación (Gherkin)
Escenario 1: Registro exitoso
Scenario: Registrar una facultad válida
Given existe un campus con id = 1
And no existe aún una facultad con codigo "12345"
When envío POST /api/facultades con:
| codigo | 12345 |
| nombre | Facultad de ciencias y tecnologia |
| nombre_corto | FCyT |
| lat | -17.3939 |
| lng | -66.15 |
| campus_id | 1 |
Then la API responde 201
And el cuerpo contiene un campo "id" (numérico) de la nueva facultad

Escenario 2: Código duplicado
Scenario: Intentar registrar con codigo ya existente
Given existe una facultad con codigo "12345"
When envío POST /api/facultades con codigo "12345" (y datos válidos)
Then la API responde 409
And el mensaje contiene "Ya existe una facultad con el mismo codigo"

Escenario 3: Falta de campos obligatorios (nombre)
Scenario: Enviar sin nombre
Given existe un campus con id = 1
When envío POST /api/facultades sin "nombre"
Then la API responde 400 (VALIDATION_ERROR)
And details incluye:
| field | message |
| nombre | No se ingresó el campo nombre |

Escenario 4: Lat/Lng ausentes o incompletos
Scenario Outline: Enviar lat/lng incompletos
Given existe un campus con id = 1
When envío POST /api/facultades con "<lat_input>" y "<lng_input>"
Then la API responde 400 (VALIDATION_ERROR)
And details incluye:
| field | message |
| lat | Si se envía lat también se debe enviar lng y viceversa |

Examples:
| lat_input | lng_input |
| -17.39 | (ausente) |
| (ausente) | -66.15 |

Escenario 5: Rangos inválidos de lat/lng
Scenario Outline: Validar rangos de coordenadas
Given existe un campus con id = 1
When envío POST /api/facultades con lat="<lat>" y lng="<lng>"
Then la API responde 400 (VALIDATION_ERROR)

Examples:
| lat | lng | Esperado |
| -91 | -66.15 | lat < -90 → "Latitud inválida" |
| 91 | -66.15 | lat > 90 → "Latitud inválida" |
| -17.39 | -181 | lng < -180 → "Longitud inválida" |
| -17.39 | 181 | lng > 180 → "Longitud inválida" |

Escenario 6: campus_id inexistente
Scenario: Campus no encontrado
Given no existe campus con id = 999
When envío POST /api/facultades con campus_id = 999 (y demás datos válidos)
Then la API responde 400 (VALIDATION_ERROR)
And details incluye:
| field | message |
| campus_id | El campus especificado no existe |

Escenario 7: nombre_corto opcional
Scenario: Registrar sin nombre_corto
Given existe un campus con id = 1
When envío POST /api/facultades con nombre_corto omitido
Then la API responde 201
And se registra la facultad con nombre_corto = null (o vacío)

Validaciones específicas (campo por campo)

codigo

Tipo: string, longitud 1..16, único.

Errores:

El codigo debe ser una cadena

El codigo debe tener entre 1 y 16 caracteres

Ya existe una facultad con el mismo codigo (409)

nombre

Tipo: string, longitud 1..128, obligatorio.

Errores:

No se ingresó el campo nombre

El nombre debe ser una cadena

El nombre no debe exceder 128 caracteres

nombre_corto

Tipo: string, longitud 1..16, opcional.

Errores (si se envía):

El nombre_corto debe ser una cadena

El nombre_corto no debe exceder 16 caracteres

lat / lng

Deben venir juntos.

lat: número en [-90, 90]

lng: número en [-180, 180]

Errores:

Si se envía lat también se debe enviar lng y viceversa

La latitud debe ser numérica

Latitud inválida

La longitud debe ser numérica

Longitud inválida

campus_id

Tipo: number, obligatorio, debe existir en campus.

Errores:

No se ingresó el campus_id

El campus especificado no existe

Definición de Hecho (DoD)

Validación de entrada en backend (mensajes claros en español).

Convertir lat/lng a POINT al persistir.

Manejo de duplicados (409) y errores de validación (400).

Endpoint documentado en Swagger con ejemplos.

Pruebas: éxito, duplicado, faltantes, rangos, lat/lng incompletos, campus inexistente.

## Listar una facultad

# Especificaciones:

Vision y alcance:

1. Listar facultades en una tabla.
2. Poder filtrar facultades por distintos filtros.
3. Poder ocultar columnas.
4. Poder ordenar columnas mediante la tabla.
5. Boton a la derecha encima de la tabla que me permitira registrar una facultad
6. Se debe contar con paginacion
7. Security by default y security by desing.

Glosario y modelo conceptual:

1. Una facultad le pertenece a un campus
2. codigo es un Identificador unico

Reglas de negocio:

1. codigo es unico
2. Se debe listar por defecto 8 facultades por pagina.
3. No se debe mostrar las coordenadas, actualizado_en ni el id de la facultad en la tabla
4. No se debe mostrar campus_id, en su lugar el nombre del campus.

Esquema:
CREATE TABLE infraestructura.facultades (
id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT BY 1 START WITH 1 ) ,
codigo varchar(16) NOT NULL UNIQUE,
nombre varchar(128) NOT NULL ,
nombre_corto varchar(16) ,
coordenadas point NOT NULL ,
activo boolean DEFAULT TRUE NOT NULL ,
creado_en timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL ,
actualizado_en timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL ,
campus_id integer NOT NULL ,
CONSTRAINT pk_facultades PRIMARY KEY ( id ),
CONSTRAINT fk_facultades_campus FOREIGN KEY ( campus_id ) REFERENCES infraestructura.campus( id )  
 );
{
"items": [
{
"codigo": "12345",
"nombre": "Facultad de cieencias y tecnologia",
"nombre_corto": "FCyT",
"lat": -17.3939,
"lng": -66.15,
"campus_id": 1,
"activo": true,
"creando_en": "2025-09-24T15:20:30.767Z",
"actualizado_en": "2025-09-24T15:20:30.767Z"
}
],
"meta": {
"total": 50,
"page": 1,
"take": 1,
"hasNextPage": true,
"hasPreviousPage": false
}
}

Contratos de API
POST /api/facultades -> 200

## HU - 6 Listar una facultad

Como administrador de infraestructura
Quiero visualizar y gestionar un listado paginado de facultades con filtros, ordenamiento y control de columnas
Para consultar rápidamente la información y acceder al registro de nuevas facultades

Alcance y reglas (resumen)

La lista se muestra en tabla con paginación (por defecto 8 por página).
Filtros por distintos campos y ordenamiento por columnas.

Ocultar/mostrar columnas desde la interfaz.

Botón encima a la derecha para registrar una nueva facultad.

No se muestran en la tabla: id, coordenadas, actualizado_en, campus_id.

En lugar de campus_id, se muestra el nombre del campus.

Seguridad por defecto y por diseño (validación de entrada, límites de paginación, manejo de errores, CORS, etc.).

Contrato de API
GET /api/facultades

Query params (opcionales):

page (número, por defecto 1)

limit (número, por defecto 8, máx. recomendado 100)

search (string; coincide por codigo, nombre, nombre_corto, o campus_nombre)

sortBy (uno de: codigo|nombre|nombre_corto|campus_nombre|creado_en, por defecto nombre)

sortDir (asc|desc, por defecto asc)

(Los ordenamientos y direccion se puede hacer desde el frontend mediante la tabla y shadcn que permite cambiar la direccion segun una columna)

activo (true | false)

campusId (número) — filtro exacto

Respuesta 200:

{
"items": [
{
"id": 1,
"codigo": "12345",
"nombre": "Facultad de ciencias y tecnologia",
"nombre_corto": "FCyT",
"campus_nombre": "Campus Central",
"activo": true,
"creado_en": "2025-09-24T15:20:30.767Z"
}
],
"meta": {
"total": 50,
"page": 1,
"take": 8,
"pages": 7,
"hasNextPage": true,
"hasPreviousPage": false
}
}

Códigos de error:

400 VALIDATION_ERROR (parámetros inválidos: página/limit fuera de rango, sortBy desconocido, etc.)

500 INTERNAL_ERROR (fallos inesperados)

Columnas visibles por defecto en la tabla

codigo
nombre
nombre_corto
campus_nombre (derivado por JOIN con campus)
activo
creado_en (formato legible en el front)

Criterios de Aceptación (Gherkin)
Escenario 1: Listado por defecto (8 por página)
Scenario: Ver primera página con tamaño por defecto
Given existen más de 8 facultades registradas
When hago GET /api/facultades sin parámetros
Then la API responde 200
And meta.take = 8
And meta.page = 1
And items.length <= 8
And cada item NO incluye id, coordenadas ni actualizado_en ni campus_id
And cada item incluye campus_nombre

Escenario 2: Paginación
Scenario: Cambiar de página
Given existen al menos 16 facultades
When hago GET /api/facultades?page=2&limit=8
Then la API responde 200
And meta.page = 2
And meta.take = 8
And items.length <= 8

Escenario 3: Búsqueda por texto (search)
Scenario Outline: Buscar por codigo/nombre/nombre_corto/campus_nombre
Given existen facultades con distintos campos poblados
When hago GET /api/facultades?search=<term>
Then la API responde 200
And todos los items contienen <term> en alguno de: codigo, nombre, nombre_corto o campus_nombre (case-insensitive)

Examples:
| term |
| 12345 |
| FCyT |
| Central|

Escenario 5: Filtros exactos (activo, campusId)
Scenario: Filtrar por activo
Given existen facultades activas e inactivas
When hago GET /api/facultades?activo=false
Then la API responde 200
And todos los items tienen activo = false

Scenario: Filtrar por campusId
Given existen facultades en distintos campus
When hago GET /api/facultades?campusId=1
Then la API responde 200
And todos los items pertenecen al campus con id = 1 (campus_nombre consistente)

Escenario 6: Ocultar columnas (UI)
Scenario: Ocultar/mostrar columnas desde la tabla
Given la tabla muestra columnas por defecto
When oculto la columna "nombre_corto" desde el control de columnas
Then la columna "nombre_corto" deja de mostrarse
And el resto de columnas permanecen visibles

Escenario 7: Botón “Registrar facultad”
Scenario: Navegar a registro de facultad
Given estoy en la lista de facultades
When hago clic en el botón "Registrar facultad" encima a la derecha
Then se abre el flujo de registro (modal de creación)

Escenario 8: Validación de parámetros de consulta
Scenario Outline: Parámetros inválidos
When hago GET /api/facultades con <param> inválido
Then la API responde 400 VALIDATION_ERROR

Examples:
| param |
| page=0 |
| page=-1 |
| limit=0 |
| limit=1000 |
| sortBy=campo_que_no_existe |
| sortDir=invalido |
| activo=quizas |
| campusId=texto |

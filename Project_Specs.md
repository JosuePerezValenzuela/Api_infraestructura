## Registrar una facultad

# Especificaciones:

Vision y alcance:

1. Crear facultades para inventario.
2. Crear facultades en menos de 2 minutos, errores de validacion comprensibles.
3. Security by default y security by desing.

Glosario y modelo conceptual:

1. Una facultad le pertenece a un campus
2. codigo es un Identificador unico

Reglas de negocio:

1. codigo es unico
2. nombre y direccion son obligatorios
3. lat y lng se envian juntos para convertir a POINT y dentro de rangos validos
4. nombre_corto es opcional.
5. campus_id indica a que campus pertenece.

Esquema:
CREATE TABLE infraestructura.facultades (
id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT BY 1 START WITH 1 ) ,
codigo varchar(16) NOT NULL UNIQUE,
nombre varchar(128) NOT NULL ,
nombre_corto varchar(16) ,
coordenadas point NOT NULL ,
activo boolean DEFAULT TRUE NOT NULL ,
creado_en timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL ,
actualizado_en timestamptz DEFAULT CURRENT_TIMESTAMP NOT NULL ,
campus_id integer NOT NULL ,
CONSTRAINT pk_facultades PRIMARY KEY ( id ),
CONSTRAINT fk_facultades_campus FOREIGN KEY ( campus_id ) REFERENCES infraestructura.campus( id )  
 );
{
"codigo": "12345",
"nombre": "Facultad de cieencias y tecnologia",
"nombre_corto": "FCyT",
"lat": -17.3939,
"lng": -66.15,
"campus_id": 1
}

Contratos de API
POST /api/facultades -> 201 { id }
400 VALIDATION_ERROR con details []
409 Ya existe una facultad con el mismo codigo

## HU - 5 Registrar una facultad

Como administrador de infraestructura
Quiero registrar una nueva facultad asociada a un campus
Para mantener un inventario centralizado y geolocalizado de la infraestructura

Alcance y reglas (resumen)

Cada facultad pertenece a un campus (campus_id requerido).

codigo es único.

nombre y coordenadas (lat,lng) son obligatorios (lat/lng deben venir juntos y dentro de rangos válidos).

nombre_corto es opcional.

Seguridad por defecto y por diseño (validación de entrada, manejo de errores claro).

Contrato de API

POST /api/facultades → 201 { id }

400 VALIDATION_ERROR con details[]

409 “Ya existe una facultad con el mismo codigo”

Ejemplo de request body

{
"codigo": "12345",
"nombre": "Facultad de ciencias y tecnologia",
"nombre_corto": "FCyT",
"lat": -17.3939,
"lng": -66.15,
"campus_id": 1
}

Criterios de Aceptación (Gherkin)
Escenario 1: Registro exitoso
Scenario: Registrar una facultad válida
Given existe un campus con id = 1
And no existe aún una facultad con codigo "12345"
When envío POST /api/facultades con:
| codigo | 12345 |
| nombre | Facultad de ciencias y tecnologia |
| nombre_corto | FCyT |
| lat | -17.3939 |
| lng | -66.15 |
| campus_id | 1 |
Then la API responde 201
And el cuerpo contiene un campo "id" (numérico) de la nueva facultad

Escenario 2: Código duplicado
Scenario: Intentar registrar con codigo ya existente
Given existe una facultad con codigo "12345"
When envío POST /api/facultades con codigo "12345" (y datos válidos)
Then la API responde 409
And el mensaje contiene "Ya existe una facultad con el mismo codigo"

Escenario 3: Falta de campos obligatorios (nombre)
Scenario: Enviar sin nombre
Given existe un campus con id = 1
When envío POST /api/facultades sin "nombre"
Then la API responde 400 (VALIDATION_ERROR)
And details incluye:
| field | message |
| nombre | No se ingresó el campo nombre |

Escenario 4: Lat/Lng ausentes o incompletos
Scenario Outline: Enviar lat/lng incompletos
Given existe un campus con id = 1
When envío POST /api/facultades con "<lat_input>" y "<lng_input>"
Then la API responde 400 (VALIDATION_ERROR)
And details incluye:
| field | message |
| lat | Si se envía lat también se debe enviar lng y viceversa |

Examples:
| lat_input | lng_input |
| -17.39 | (ausente) |
| (ausente) | -66.15 |

Escenario 5: Rangos inválidos de lat/lng
Scenario Outline: Validar rangos de coordenadas
Given existe un campus con id = 1
When envío POST /api/facultades con lat="<lat>" y lng="<lng>"
Then la API responde 400 (VALIDATION_ERROR)

Examples:
| lat | lng | Esperado |
| -91 | -66.15 | lat < -90 → "Latitud inválida" |
| 91 | -66.15 | lat > 90 → "Latitud inválida" |
| -17.39 | -181 | lng < -180 → "Longitud inválida" |
| -17.39 | 181 | lng > 180 → "Longitud inválida" |

Escenario 6: campus_id inexistente
Scenario: Campus no encontrado
Given no existe campus con id = 999
When envío POST /api/facultades con campus_id = 999 (y demás datos válidos)
Then la API responde 400 (VALIDATION_ERROR)
And details incluye:
| field | message |
| campus_id | El campus especificado no existe |

Escenario 7: nombre_corto opcional
Scenario: Registrar sin nombre_corto
Given existe un campus con id = 1
When envío POST /api/facultades con nombre_corto omitido
Then la API responde 201
And se registra la facultad con nombre_corto = null (o vacío)

Validaciones específicas (campo por campo)

codigo

Tipo: string, longitud 1..16, único.

Errores:

El codigo debe ser una cadena

El codigo debe tener entre 1 y 16 caracteres

Ya existe una facultad con el mismo codigo (409)

nombre

Tipo: string, longitud 1..128, obligatorio.

Errores:

No se ingresó el campo nombre

El nombre debe ser una cadena

El nombre no debe exceder 128 caracteres

nombre_corto

Tipo: string, longitud 1..16, opcional.

Errores (si se envía):

El nombre_corto debe ser una cadena

El nombre_corto no debe exceder 16 caracteres

lat / lng

Deben venir juntos.

lat: número en [-90, 90]

lng: número en [-180, 180]

Errores:

Si se envía lat también se debe enviar lng y viceversa

La latitud debe ser numérica

Latitud inválida

La longitud debe ser numérica

Longitud inválida

campus_id

Tipo: number, obligatorio, debe existir en campus.

Errores:

No se ingresó el campus_id

El campus especificado no existe

Definición de Hecho (DoD)

Validación de entrada en backend (mensajes claros en español).

Convertir lat/lng a POINT al persistir.

Manejo de duplicados (409) y errores de validación (400).

Endpoint documentado en Swagger con ejemplos.

Pruebas: éxito, duplicado, faltantes, rangos, lat/lng incompletos, campus inexistente.
